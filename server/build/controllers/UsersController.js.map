{"version":3,"sources":["../../src/controllers/UsersController.js"],"names":["dotenv","config","users","models","UsersController","req","res","body","fullname","username","email","address","phone","password","confirmPassword","isAdmin","serviceName","imgUrl","find","where","type","then","user","salt","bcrypt","genSaltSync","hashedPassword","hashSync","create","Boolean","createdUser","authenKeys","id","token","jwt","sign","process","env","SECRET_KEY","expiresIn","catch","passwordConfirmed","compareSync","findServiceName","serviceNames"],"mappings":"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","file":"UsersController.js","sourcesContent":["import dotenv from 'dotenv-safe';\r\nimport jwt from 'jsonwebtoken';\r\nimport bcrypt from 'bcrypt';\r\nimport models from './../models/index';\r\nimport { handleResponse } from './../services/services';\r\n\r\ndotenv.config();\r\n\r\nconst { users } = models;\r\nconst UsersController = class {\r\n  // create a new user account\r\n  static signup(req, res) {\r\n    const {\r\n      fullname,\r\n      username,\r\n      email,\r\n      address,\r\n      phone,\r\n      password,\r\n      confirmPassword,\r\n      isAdmin,\r\n      serviceName,\r\n      imgUrl,\r\n    } = req.body;\r\n\r\n    return users\r\n      .find({\r\n        where: {\r\n          username,\r\n          email,\r\n        },\r\n        type: 'or',\r\n      })\r\n      .then((user) => {\r\n        if (!user) {\r\n          const salt = bcrypt.genSaltSync(10);\r\n          const hashedPassword = bcrypt.hashSync(password, salt);\r\n          return users\r\n            .create({\r\n              fullname,\r\n              email,\r\n              username,\r\n              address,\r\n              serviceName,\r\n              phone,\r\n              imgUrl,\r\n              password: hashedPassword,\r\n              isAdmin: Boolean(isAdmin) || false,\r\n            })\r\n            .then((createdUser) => {\r\n              const authenKeys = {\r\n                fullname: createdUser.fullname,\r\n                email: createdUser.email,\r\n                username: createdUser.username,\r\n                phone: createdUser.phone,\r\n                imgUrl: createdUser.imgUrl,\r\n                id: createdUser.id,\r\n                isAdmin: createdUser.isAdmin,\r\n                serviceName: createdUser.serviceName,\r\n              };\r\n              const token = jwt.sign(authenKeys, process.env.SECRET_KEY, { expiresIn: '48h' });\r\n              handleResponse(res, 201, {\r\n                token,\r\n                fullname: createdUser.fullname,\r\n                email: createdUser.email,\r\n                username: createdUser.username,\r\n                imgUrl: createdUser.imgUrl,\r\n                id: createdUser.id,\r\n                isAdmin: createdUser.isAdmin,\r\n                serviceName: createdUser.serviceName,\r\n              })\r\n            })\r\n            .catch(() => handleResponse(res, 500, 'something went wrong! try again later'));\r\n        }\r\n        return handleResponse(res, 409, 'user already exist');\r\n      })\r\n      .catch(() => handleResponse(res, 500, 'something went wrong! try again later'));\r\n  }\r\n\r\n  // signin controller\r\n  static signin(req, res) {\r\n    const {\r\n      username,\r\n      password,\r\n    } = req.body;\r\n\r\n    return users\r\n      .find({\r\n        where: {\r\n          username,\r\n        },\r\n      })\r\n      .then((user) => {\r\n        if (user) {\r\n          let passwordConfirmed = false;\r\n          const hashedPassword = user.password;\r\n          passwordConfirmed = bcrypt.compareSync(password, hashedPassword);\r\n          if (passwordConfirmed) {\r\n            const authenKeys = {\r\n              username: user.username,\r\n              fullname: user.fullname,\r\n              isAdmin: user.isAdmin,\r\n              id: user.id,\r\n              imgUrl: user.imgUrl,\r\n              serviceName: user.serviceName,\r\n            };\r\n            const token = jwt.sign(authenKeys, process.env.SECRET_KEY, { expiresIn: '48h' });\r\n            return handleResponse(res, 200, {\r\n              token,\r\n              fullname: user.fullname,\r\n              email: user.email,\r\n              username: user.username,\r\n              imgUrl: user.imgUrl,\r\n              id: user.id,\r\n              isAdmin: user.isAdmin,\r\n              serviceName: user.serviceName,\r\n            });\r\n          }\r\n            return handleResponse(res, 401, 'authentication fail! check your username or password');\r\n        } \r\n          return handleResponse(res, 401, 'authentication fail! check your username or password');\r\n      })\r\n      .catch(() => handleResponse(res, 500, 'something went wrong! try again later'));\r\n  }\r\n\r\n  static getServiceName(req, res) {\r\n    return users\r\n      .findServiceName()\r\n      .then((serviceNames) => {\r\n        if (serviceNames) {\r\n          return handleResponse(res, 200, serviceNames);\r\n        }\r\n        return handleResponse(res, 404, 'service not avialable yet');\r\n      })\r\n      .catch(() => handleResponse(res, 500, 'something went wrong! try again later'));\r\n  }\r\n};\r\n\r\nexport default UsersController;\r\n"]}