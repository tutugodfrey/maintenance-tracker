{"version":3,"sources":["../../src/controllers/AdminController.js"],"names":["requests","models","AdminController","req","res","isAdmin","query","status","send","message","findAll","then","allRequests","catch","requestId","parseInt","params","updatedAt","Services","getDate","dateRegExp","test","findById","request","update","id","updatedRequest","error"],"mappings":"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","file":"AdminController.js","sourcesContent":["\r\nimport models from './../models/index';\r\nimport Services from './../helpers/Services';\r\n\r\nconst { requests } = models;\r\nconst AdminController = class {\r\n  // get all request for a logged in user\r\n  static getAllRequests(req, res) {\r\n    const { isAdmin } = req.query;\r\n    if (isAdmin !== 'true') {\r\n      return res.status(402).send({ message: 'missing required field' });\r\n    }\r\n    return requests\r\n      .findAll()\r\n      .then(allRequests => res.status(200).send(allRequests))\r\n      .catch(() => res.status(500).send({ message: 'some went wrong'}));\r\n  }\r\n\r\n  static rejectRequest(req, res) {\r\n    const requestId = parseInt(req.params.requestId, 10);\r\n    const { isAdmin } = req.query;\r\n    if (isAdmin !== 'true') {\r\n      return res.status(402).send({ message: 'you are not permitted to perform this action' });\r\n    }\r\n    if (isAdmin !== 'true' || !requestId) {\r\n      return res.status(400).send({ message: 'missiging required field' });\r\n    }\r\n    const updatedAt = Services.getDate();\r\n    const dateRegExp = /\\d{4}-\\d{2}-\\d{2}/;\r\n    if (!dateRegExp.test(updatedAt)) {\r\n      return res.status(500).send({ message: 'an error occur while processing your request' });\r\n    }\r\n    return requests\r\n      .findById(requestId)\r\n      .then((request) => {\r\n        return requests\r\n          .update(\r\n            {\r\n              id: request.id,\r\n            },\r\n            {\r\n              updatedAt: 'now()',\r\n              status: 'rejected',\r\n            },\r\n          )\r\n          .then(updatedRequest => res.status(200).send(updatedRequest));\r\n      })\r\n      .catch(error => res.status(404).send(error));\r\n  }\r\n\r\n  static approveRequest(req, res) {\r\n    const requestId = parseInt(req.params.requestId, 10);\r\n    const { isAdmin } = req.query;\r\n    if (isAdmin !== 'true') {\r\n      return res.status(402).send({ message: 'you are not permitted to perform this action' });\r\n    }\r\n    if (!requestId) {\r\n      return res.status(400).send({ message: 'missiging required field' });\r\n    }\r\n    const updatedAt = Services.getDate();\r\n    const dateRegExp = /\\d{4}-\\d{2}-\\d{2}/;\r\n    if (!dateRegExp.test(updatedAt)) {\r\n      return res.status(500).send({ message: 'an error occur while processing your request' });\r\n    }\r\n    return requests\r\n      .findById(requestId)\r\n      .then((request) => {\r\n        return requests\r\n          .update(\r\n            {\r\n              id: request.id,\r\n            },\r\n            {\r\n              updatedAt: 'now()',\r\n              status: 'pending',\r\n            },\r\n          )\r\n          .then(updatedRequest => res.status(200).send(updatedRequest));\r\n      })\r\n      .catch(error => res.status(404).send(error));\r\n  }\r\n\r\n  static resolveRequest(req, res) {\r\n    const requestId = parseInt(req.params.requestId, 10);\r\n    const { isAdmin } = req.query;\r\n    if (isAdmin !== 'true') {\r\n      return res.status(402).send({ message: 'you are not permitted to perform this action' });\r\n    }\r\n    if (!requestId) {\r\n      return res.status(400).send({ message: 'missiging required field' });\r\n    }\r\n    const updatedAt = Services.getDate();\r\n    const dateRegExp = /\\d{4}-\\d{2}-\\d{2}/;\r\n    if (!dateRegExp.test(updatedAt)) {\r\n      return res.status(500).send({ message: 'an error occur while processing your request' });\r\n    }\r\n    return requests\r\n      .findById(requestId)\r\n      .then((request) => {\r\n        return requests\r\n          .update(\r\n            {\r\n              id: request.id,\r\n            },\r\n            {\r\n              updatedAt: 'now()',\r\n              status: 'resolved',\r\n            },\r\n          )\r\n          .then(updatedRequest => res.status(200).send(updatedRequest));\r\n      })\r\n      .catch(error => res.status(404).send(error));\r\n  }\r\n};\r\nexport default AdminController;\r\n"]}