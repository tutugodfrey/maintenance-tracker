{"version":3,"sources":["../../src/controllers/ContactController.js"],"names":["users","models","contacts","ContactController","req","res","userId","parseInt","body","adminId","senderId","message","trim","status","send","findById","then","user","create","title","newMessage","catch","error","query","isAdmin","findAll","messages","where"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEQA,K,GAAoBC,e,CAApBD,K;IAAOE,Q,GAAaD,e,CAAbC,Q;;AACf,IAAMC;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACJ;AADI,+BAEcC,GAFd,EAEmBC,GAFnB,EAEwB;AAC1B,UAAMC,SAASC,SAASH,IAAII,IAAJ,CAASF,MAAlB,EAA0B,EAA1B,CAAf;AACA,UAAMG,UAAUF,SAASH,IAAII,IAAJ,CAASC,OAAlB,EAA2B,EAA3B,CAAhB;AACA,UAAMC,WAAWH,SAASH,IAAII,IAAJ,CAASE,QAAlB,EAA4B,EAA5B,CAAjB;AACA,UAAMC,UAAUP,IAAII,IAAJ,CAASG,OAAT,CAAiBC,IAAjB,EAAhB;AACA,UAAI,CAACN,MAAD,IAAW,CAACG,OAAZ,IAAuB,CAACC,QAA5B,EAAsC;AACpC,eAAOL,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEH,SAAS,wBAAX,EAArB,CAAP;AACD;AACD,aAAOX,MACJe,QADI,CACKL,QADL,EAEJM,IAFI,CAEC,UAACC,IAAD,EAAU;AACd,eAAOf,SACJgB,MADI,CACG;AACNZ,wBADM;AAENG,0BAFM;AAGNC,4BAHM;AAINC,0BAJM;AAKNQ,iBAAOf,IAAII,IAAJ,CAASW;AALV,SADH,EAQJH,IARI,CAQC,UAACI,UAAD,EAAgB;AACpBf,cAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBM,kCADmB;AAEnBH;AAFmB,WAArB;AAID,SAbI,EAcJI,KAdI,CAcE;AAAA,iBAAShB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBQ,KAArB,CAAT;AAAA,SAdF,CAAP;AAeD,OAlBI,EAmBJD,KAnBI,CAmBE;AAAA,eAAShB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBQ,KAArB,CAAT;AAAA,OAnBF,CAAP;AAoBD;AA9BG;AAAA;AAAA,gCAgCelB,GAhCf,EAgCoBC,GAhCpB,EAgCyB;AAC3B,UAAMC,SAASC,SAASH,IAAImB,KAAJ,CAAUjB,MAAnB,EAA2B,EAA3B,CAAf;AAD2B,UAEnBkB,OAFmB,GAEPpB,IAAImB,KAFG,CAEnBC,OAFmB;;AAG3B,UAAI,EAAElB,UAAUkB,OAAZ,CAAJ,EAA0B;AACxB,eAAOnB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEH,SAAS,wBAAX,EAArB,CAAP;AACD;AACD,UAAIa,YAAY,MAAhB,EAAwB;AACtB,eAAOtB,SACJuB,OADI,GAEJT,IAFI,CAEC;AAAA,iBAAYX,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBY,QAArB,CAAZ;AAAA,SAFD,EAGJL,KAHI,CAGE;AAAA,iBAAShB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBQ,KAArB,CAAT;AAAA,SAHF,CAAP;AAID;AACD,aAAOpB,SACJuB,OADI,CACI;AACPE,eAAO;AACLrB;AADK;AADA,OADJ,EAMJU,IANI,CAMC;AAAA,eAAYX,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBY,QAArB,CAAZ;AAAA,OAND,EAOJL,KAPI,CAOE;AAAA,eAAShB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBQ,KAArB,CAAT;AAAA,OAPF,CAAP;AAQD;AApDG;;AAAA;AAAA,GAAN;;kBAuDenB,iB","file":"ContactController.js","sourcesContent":["import models from './../models/index';\r\n\r\nconst { users, contacts } = models;\r\nconst ContactController = class {\r\n  // create a new message\r\n  static addMessage(req, res) {\r\n    const userId = parseInt(req.body.userId, 10);\r\n    const adminId = parseInt(req.body.adminId, 10);\r\n    const senderId = parseInt(req.body.senderId, 10);\r\n    const message = req.body.message.trim();\r\n    if (!userId || !adminId || !senderId) {\r\n      return res.status(400).send({ message: 'missing required field' });\r\n    }\r\n    return users\r\n      .findById(senderId)\r\n      .then((user) => {\r\n        return contacts\r\n          .create({\r\n            userId,\r\n            adminId,\r\n            senderId,\r\n            message,\r\n            title: req.body.title,\r\n          })\r\n          .then((newMessage) => {\r\n            res.status(201).send({\r\n              newMessage,\r\n              user,\r\n            });\r\n          })\r\n          .catch(error => res.status(400).send(error));\r\n      })\r\n      .catch(error => res.status(404).send(error));\r\n  }\r\n\r\n  static getMessages(req, res) {\r\n    const userId = parseInt(req.query.userId, 10);\r\n    const { isAdmin } = req.query;\r\n    if (!(userId || isAdmin)) {\r\n      return res.status(400).send({ message: 'missing required field' });\r\n    }\r\n    if (isAdmin === 'true') {\r\n      return contacts\r\n        .findAll()\r\n        .then(messages => res.status(200).send(messages))\r\n        .catch(error => res.status(500).send(error));\r\n    }\r\n    return contacts\r\n      .findAll({\r\n        where: {\r\n          userId,\r\n        },\r\n      })\r\n      .then(messages => res.status(200).send(messages))\r\n      .catch(error => res.status(500).send(error));\r\n  }\r\n};\r\n\r\nexport default ContactController;\r\n"]}