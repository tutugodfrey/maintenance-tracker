{"version":3,"sources":["../../src/routes/index.js"],"names":["UsersStorage","multer","diskStorage","destination","filename","req","file","cb","originalname","usersUpload","storage","Routes","UsersController","RequestController","ContactController","app","get","res","status","send","message","use","next","token","headers","promise","Promise","resolve","reject","jwt","verify","process","env","SECRET_KEY","err","decode","post","single","signup","signin","addRequest","getOneRequest","getAllRequests","put","updateRequest","delete","deleteRequest","addMessage","getMessages"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,eAAeC,iBAAOC,WAAP,CAAmB;AACtCC,eAAa,uBADyB;AAEtCC,YAAU,kBAACC,GAAD,EAAMC,IAAN,EAAYC,EAAZ,EAAmB;AAC3BA,OAAG,IAAH,EAASD,KAAKE,YAAd;AACD;AAJqC,CAAnB,CAArB;AAMA,IAAMC,cAAc,sBAAO,EAAEC,SAASV,YAAX,EAAP,CAApB;AACA;AACA,IAAMW;AACJ,oBAAc;AAAA;;AACZ,SAAKC,eAAL,GAAuBA,yBAAvB;AACA,SAAKC,iBAAL,GAAyBA,2BAAzB;AACA,SAAKC,iBAAL,GAAyBA,2BAAzB;AACD;AACD;;;AANI;AAAA;AAAA,2BAOGC,GAPH,EAOQ;AACVA,UAAIC,GAAJ,CAAQ,GAAR,EAAa,UAACX,GAAD,EAAMY,GAAN,EAAc;AACzBA,YAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,qCAAX,EAArB;AACD,OAFD;;AAIA;AACAL,UAAIM,GAAJ,CAAQ,UAAR,EAAoB,UAAChB,GAAD,EAAMY,GAAN,EAAWK,IAAX,EAAoB;AAAA,YAC9BC,KAD8B,GACpBlB,IAAImB,OADgB,CAC9BD,KAD8B;AAEtC;;AACA,YAAME,UAAU,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,cAAIL,KAAJ,EAAW;AACTM,mCAAIC,MAAJ,CAAWP,KAAX,EAAkBQ,QAAQC,GAAR,CAAYC,UAA9B,EAA0C,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACzD,kBAAID,GAAJ,EAAS;AACPP,wBAAQV,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,eAArB,CAAR;AACD,eAFD,MAEO;AACLQ,wBAAQL,MAAR;AACD;AACF,aAND;AAOD,WARD,MAQO;AACLK,oBAAQV,IAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qBAArB,CAAR;AACD;AACF,SAZe,CAAhB;AAaA,eAAOM,OAAP;AACD,OAjBD;AAkBA;AACAV,UAAIqB,IAAJ,CAAS,qBAAT,EAAgC3B,YAAY4B,MAAZ,CAAmB,eAAnB,CAAhC,EAAqE,KAAKzB,eAAL,CAAqB0B,MAA1F;AACAvB,UAAIqB,IAAJ,CAAS,qBAAT,EAAgC,KAAKxB,eAAL,CAAqB2B,MAArD;AACA;AACAxB,UAAIqB,IAAJ,CAAS,+BAAT,EAA0C,KAAKvB,iBAAL,CAAuB2B,UAAjE;AACAzB,UAAIC,GAAJ,CAAQ,0CAAR,EAAoD,KAAKH,iBAAL,CAAuB4B,aAA3E;AACA1B,UAAIC,GAAJ,CAAQ,+BAAR,EAAyC,KAAKH,iBAAL,CAAuB6B,cAAhE;AACA3B,UAAI4B,GAAJ,CAAQ,0CAAR,EAAoD,KAAK9B,iBAAL,CAAuB+B,aAA3E;AACA7B,UAAI8B,MAAJ,CAAW,0CAAX,EAAuD,KAAKhC,iBAAL,CAAuBiC,aAA9E;;AAEA;AACA/B,UAAIqB,IAAJ,CAAS,yBAAT,EAAoC,KAAKtB,iBAAL,CAAuBiC,UAA3D;AACAhC,UAAIC,GAAJ,CAAQ,yBAAR,EAAmC,KAAKF,iBAAL,CAAuBkC,WAA1D;AACD;AA5CG;;AAAA;AAAA,GAAN;;kBA+CerC,M","file":"index.js","sourcesContent":["import multer from 'multer';\r\nimport jwt from 'jsonwebtoken';\r\nimport UsersController from './../controllers/UsersController';\r\nimport RequestController from './../controllers/RequestController';\r\nimport ContactController from './../controllers/ContactController';\r\n\r\nconst UsersStorage = multer.diskStorage({\r\n  destination: './public/users-photo/',\r\n  filename: (req, file, cb) => {\r\n    cb(null, file.originalname);\r\n  },\r\n});\r\nconst usersUpload = multer({ storage: UsersStorage });\r\n// const requestController = new RequestController();\r\nconst Routes = class {\r\n  constructor() {\r\n    this.UsersController = UsersController;\r\n    this.RequestController = RequestController;\r\n    this.ContactController = ContactController;\r\n  }\r\n  /* eslint-disable class-methods-use-thiss */\r\n  routes(app) {\r\n    app.get('/', (req, res) => {\r\n      res.status(200).send({ message: 'welcome to the maintenance trackers' });\r\n    });\r\n\r\n    // secure api\r\n    app.use('/secure/', (req, res, next) => {\r\n      const { token } = req.headers;\r\n      /* eslint-disable no-unused-vars */\r\n      const promise = new Promise((resolve, reject) => {\r\n        if (token) {\r\n          jwt.verify(token, process.env.SECRET_KEY, (err, decode) => {\r\n            if (err) {\r\n              resolve(res.status(401).send('Invalid Token'));\r\n            } else {\r\n              resolve(next());\r\n            }\r\n          });\r\n        } else {\r\n          resolve(res.status(402).send('Please send a token'));\r\n        }\r\n      });\r\n      return promise;\r\n    });\r\n    // routes for us\r\n    app.post('/api/v1/auth/signup', usersUpload.single('profile-photo'), this.UsersController.signup);\r\n    app.post('/api/v1/auth/signin', this.UsersController.signin);\r\n    // routes for requests model\r\n    app.post('/secure/api/v1/users/requests', this.RequestController.addRequest);\r\n    app.get('/secure/api/v1/users/requests/:requestId', this.RequestController.getOneRequest);\r\n    app.get('/secure/api/v1/users/requests', this.RequestController.getAllRequests);\r\n    app.put('/secure/api/v1/users/requests/:requestId', this.RequestController.updateRequest);\r\n    app.delete('/secure/api/v1/users/requests/:requestId', this.RequestController.deleteRequest);\r\n\r\n    // routes for contacts model\r\n    app.post('/secure/api/v1/contacts', this.ContactController.addMessage);\r\n    app.get('/secure/api/v1/contacts', this.ContactController.getMessages);\r\n  }\r\n};\r\n\r\nexport default Routes;\r\n"]}